services:
  pinchat:
    build: .
    container_name: pinchat
    ports:
      - "127.0.0.1:3000:3000"
    volumes:
      - ./certs:/app/certs:ro
    env_file:
      - .env
    tmpfs:
      - /tmp:mode=1777,size=512M
    restart: unless-stopped
    
    # Security options
    security_opt:
      - no-new-privileges:true
    
    # Linux capabilities
    cap_drop:
      - ALL
    cap_add:
      - CHOWN        # If the app needs to change file ownership
      - SETUID       # If the app needs to change user IDs
      - SETGID       # If the app needs to change group IDs
    
    # Uncomment after testing:
    # read_only: true
    # tmpfs:
    #   - /tmp:mode=1777,size=512M
    #   - /app/target:mode=1777,size=256M  # If the app needs to write to target