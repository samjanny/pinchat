# ═══════════════════════════════════════════════════════════════
# Server Binding Configuration
# ═══════════════════════════════════════════════════════════════
# Configure the IP address and port the server listens on.
# Default: 127.0.0.1:3000 (localhost only)
# Use 0.0.0.0 to listen on all interfaces (required for Docker/production)

# Host IP address (IPv4)
# Examples: 127.0.0.1 (localhost only), 0.0.0.0 (all interfaces)
HOST=127.0.0.1

# Port number
# Default: 3000
PORT=3000

# ═══════════════════════════════════════════════════════════════
# Privacy Mode Configuration
# ═══════════════════════════════════════════════════════════════

# Privacy mode configuration
# Options: strict, minimal, development
# - strict: Zero logs (only panic/crash)
# - minimal: Warning/error logs without metadata
# - development: Full debug logs
PRIVACY_MODE=strict

# DoS Protection: Maximum concurrent rooms
# Default: 1000
# Prevents memory exhaustion from room creation attacks
# Adjust based on your server's RAM capacity
MAX_TOTAL_ROOMS=1000

# ═══════════════════════════════════════════════════════════════
# Rate Limiting Configuration
# ═══════════════════════════════════════════════════════════════
# All rate limits are configurable to balance security vs usability.
# Adjust these values based on your deployment context.

# WebSocket Connection Rate Limiting
# Prevents connection flooding attacks
# Default: 5 connections per 60 seconds (per IP)
WS_CONN_BURST_SIZE=5
WS_CONN_PERIOD_SECS=60

# Room/Token Creation Rate Limiting
# Prevents room creation spam and token generation abuse
# Default: 20 requests per hour (per IP)
# Note: Both room creation and token generation share this limit
ROOM_TOKEN_BURST_SIZE=20
ROOM_TOKEN_PERIOD_SECS=3600

# Per-Connection Message Rate Limiting
# Prevents bandwidth exhaustion and client-side decryption DoS
# Default: 5 messages per second (per connection)
MSG_RATE_LIMIT=5
MSG_RATE_WINDOW_SECS=1

# Anti-Replay Cache Configuration
# Maximum message hashes stored per room to prevent replay attacks
# Older entries are evicted when limit is reached (LRU)
# Default: 10000 (with 64-byte hashes = ~640KB max per room)
# Lower values reduce memory but may allow replays of older messages
REPLAY_CACHE_MAX_PER_ROOM=10000

# ═══════════════════════════════════════════════════════════════
# Proof-of-Work Configuration
# ═══════════════════════════════════════════════════════════════
# Dynamic difficulty scaling based on server load (0-100% usage)

# Minimum PoW difficulty (at 0-30% server load)
# Default: 15 bits (~0.6s avg, ~2s on slow devices)
# Range: 10-30 bits (lower = easier for clients)
POW_MIN_DIFFICULTY=15

# Maximum PoW difficulty (at 95-100% server load)
# Default: 20 bits (~20s avg, ~60s on slow devices)
# Range: 10-30 bits (higher = stronger DoS protection)
POW_MAX_DIFFICULTY=20

# Challenge Time-to-Live
# How long a PoW challenge remains valid before expiration
# Default: 300 seconds (5 minutes)
# Shorter TTL = more security, longer TTL = better UX for slow clients
CHALLENGE_TTL_SECS=300

# ═══════════════════════════════════════════════════════════════
# Authentication Configuration
# ═══════════════════════════════════════════════════════════════

# JWT Token Time-to-Live
# How long WebSocket authentication tokens remain valid
# Default: 30 seconds
# Balance: Long enough for connection setup, short enough to prevent reuse
JWT_TOKEN_TTL_SECS=30

# ═══════════════════════════════════════════════════════════════
# Beta Access Authentication (Password-Only Login)
# ═══════════════════════════════════════════════════════════════
# Configure password hashes for beta access control.
# Leave empty to disable authentication (open access).

# Password Hashes (Argon2id)
# Semicolon-separated list of Argon2id password hashes
# Generate hashes using: cargo run --bin generate_hash -- "your_password"
# Example with one password:
#   PINCHAT_PASSWORD_HASHES='$argon2id$v=19$m=47104,t=1,p=1$...''
# Example with multiple passwords:
#   PINCHAT_PASSWORD_HASHES='$argon2id$v=19$...$hash1;$argon2id$v=19$...$hash2'
# IMPORTANT: Use the single quotes to prevent dotenv interpolation
PINCHAT_PASSWORD_HASHES=

# Session Time-to-Live
# How long a login session remains valid (with sliding window refresh)
# Default: 86400 seconds (24 hours)
SESSION_TTL_SECS=86400

# Login Rate Limiting (Brute Force Protection)
# Prevents password guessing attacks
# Default: 5 attempts per 900 seconds (15 minutes) per IP
LOGIN_BURST_SIZE=5
LOGIN_PERIOD_SECS=900

# ═══════════════════════════════════════════════════════════════
# Trusted Proxy Configuration
# ═══════════════════════════════════════════════════════════════
# When running behind a load balancer or reverse proxy, configure
# trusted proxy IPs/CIDRs to properly identify client IPs from
# X-Forwarded-For headers.
#
# SECURITY WARNING: Only trust proxies you control!
# Trusting arbitrary IPs allows attackers to spoof their IP address.
#
# Format: Comma-separated list of IPs or CIDR ranges
# Examples:
#   Single IP:     TRUSTED_PROXIES=10.0.0.1
#   Multiple IPs:  TRUSTED_PROXIES=10.0.0.1,10.0.0.2
#   CIDR range:    TRUSTED_PROXIES=10.0.0.0/8
#   Mixed:         TRUSTED_PROXIES=10.0.0.1,192.168.0.0/16,172.16.0.0/12
#
# Common configurations:
#   Docker bridge:    TRUSTED_PROXIES=172.17.0.0/16
#   Kubernetes:       TRUSTED_PROXIES=10.0.0.0/8
#   AWS ALB:          Use the VPC CIDR of your ALB subnets
#   Cloudflare:       See https://www.cloudflare.com/ips/
#
# Leave empty to disable X-Forwarded-For processing (direct connections only)
TRUSTED_PROXIES=

# ═══════════════════════════════════════════════════════════════
# Background Task Configuration
# ═══════════════════════════════════════════════════════════════

# Room Cleanup Interval
# How frequently to check for and remove expired rooms
# Default: 60 seconds
# Lower = more precise cleanup, higher = less CPU overhead
ROOM_CLEANUP_INTERVAL_SECS=60

# Challenge Cache Cleanup Interval
# How frequently to remove expired PoW challenges from memory
# Default: 60 seconds
CHALLENGE_CLEANUP_INTERVAL_SECS=60

# ═══════════════════════════════════════════════════════════════
# Image Sharing Configuration
# ═══════════════════════════════════════════════════════════════

# Maximum Image Size
# Maximum allowed size for shared images (before encryption)
# Supports: plain number (bytes), KB suffix, MB suffix
# Examples: 307200, 300KB, 1MB
# Default: 300KB
MAX_IMAGE_SIZE=300KB

# ═══════════════════════════════════════════════════════════════
# Static Files / Website Directory Configuration
# ═══════════════════════════════════════════════════════════════

# Custom Website Directory
# When set, static files are served from this directory first,
# falling back to the built-in /static directory if not found.
# Useful for serving a custom frontend while keeping the default as fallback.
# Default: empty (use only /static)
# Example: WEBSITE_DIR=/var/www/pinchat-website
WEBSITE_DIR=

# ═══════════════════════════════════════════════════════════════
# Reverse Proxy / TLS Configuration
# ═══════════════════════════════════════════════════════════════
# Settings for running behind a TLS-terminating reverse proxy
# (nginx, CloudFlare, AWS ALB, Traefik, etc.)

# Force HTTP Mode
# Set to true to disable TLS even if certificates exist in certs/
# Use when running behind a reverse proxy that handles TLS termination
# Default: false
# Accepts: true, 1, yes (case-insensitive)
FORCE_HTTP=false

# Force Secure Cookies
# Set to true to always set the Secure flag on cookies
# REQUIRED when behind a TLS-terminating proxy to prevent cookie leakage
# Default: false (auto-detected based on certs/ presence)
# Accepts: true, 1, yes (case-insensitive)
FORCE_SECURE_COOKIES=false

# ═══════════════════════════════════════════════════════════════
# Example: nginx reverse proxy configuration
# ═══════════════════════════════════════════════════════════════
# FORCE_HTTP=true
# FORCE_SECURE_COOKIES=true
# TRUSTED_PROXIES=127.0.0.1
#
# nginx config:
#   server {
#       listen 443 ssl;
#       ssl_certificate /path/to/cert.pem;
#       ssl_certificate_key /path/to/key.pem;
#       location / {
#           proxy_pass http://127.0.0.1:3000;
#           proxy_http_version 1.1;
#           proxy_set_header Upgrade $http_upgrade;
#           proxy_set_header Connection "upgrade";
#           proxy_set_header Host $host;
#           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#           proxy_set_header X-Forwarded-Proto $scheme;
#       }
#   }
